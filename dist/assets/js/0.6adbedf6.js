(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{136:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h2",{attrs:{id:"序言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#序言","aria-hidden":"true"}},[t._v("#")]),t._v(" 序言")]),a("p",[t._v("昨天与同事讨论Hexo博客，了解到了一个工具叫 Travis CI。即兴之下，查阅使用方法，尝试使用并写下此文。")]),a("p",[t._v("以往本人的部署方式是：\nhexo使用的部署命令是把生成好的静态文件上传到仓库中的，所以，在其他电脑上同步下来的只是生成后的静态文件而已，不是源码。")]),a("p",[t._v("到这里就会想到能不能这样：将源码同步到远程仓库后，可以实现自动生成部署呢？\n答案是肯定的，可以通过Travis CI来实现。")]),a("p",[t._v("本文介绍 Travis CI 的 Linux/Mac 系统下的基本用法。\n用好它，能提高效率，还能使开发流程更稳健、专业。而且，它对于开源项目（如github个人项目）是免费的。")]),a("blockquote",[a("p",[t._v("说明：\n文中出现的命令，Windows用户注意，命令前面有 $ 的表示在Git Bash中执行，没有的在CMD命令窗口执行。\nLinux和Mac系统在终端下不区分。\n文末将会提及关于用户使用Windows系统通过 Travis CI 解密证书时报错问题。")])]),a("h2",{attrs:{id:"使用准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用准备","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用准备")]),a("p",[t._v("Travis CI 只支持 Github，不支持其他代码托管服务。这意味着，你必须满足以下条件，才能使用 Travis CI。")]),a("blockquote",[a("ul",[a("li",[t._v("拥有 GitHub 帐号")]),a("li",[t._v("该帐号下面有一个项目")]),a("li",[t._v("该项目里面有可运行的代码\n这里主要讲述 Travis CI，搭建博客请参考"),a("a",{attrs:{href:"https://www.jianshu.com/p/f4cc5866946b",target:"_blank",rel:"noopener noreferrer"}},[t._v("hexo+github 搭建个人博客")])])])]),a("p",[t._v("上述条件都准备好，就可以开始使用 Travis CI 了。")]),a("p",[t._v("（1）访问官方网站 "),a("a",{attrs:{href:"https://travis-ci.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("travis-ci.org")]),t._v("，点击右上角的个人头像，使用 Github 账户登陆 Travis CI。\n"),a("img",{attrs:{src:"/assets/img/travisCI/01.png",alt:"",title:"登陆"}})]),a("p",[t._v("（2）Travis 会列出 Github 上面你的所有仓库，以及你所属于的组织。此时，选择你需要 Travis 帮你构建的仓库，打开仓库旁边的开关。一旦激活了一个仓库，Travis 会监听这个仓库的所有变化。")]),a("p",[t._v("在右上角你的账户名点击进入 Profile，在Repositories tab页点击Sync now同步你的github项目。\n"),a("img",{attrs:{src:"/assets/img/travisCI/02.png",alt:"",title:"激活并监听仓库"}})]),a("h2",{attrs:{id:"配置travis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置travis","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置Travis")]),a("p",[t._v("（1）新建配置文件")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" 博客项目文件夹根目录\n$ "),a("span",{attrs:{class:"token function"}},[t._v("touch")]),t._v(" .travis.yml\n")])]),a("p",[t._v("（2）在项目的根目录建立 "),a("strong",[t._v(".travis")]),t._v(" 文件夹")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" .travis\n")])]),a("p",[t._v("（3）复制ssh文件 "),a("strong",[t._v("id_rsa")]),t._v(" 到 "),a("strong",[t._v(".travis")]),t._v(" 目录下")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" 博客项目文件夹根目录/.travis\n")])]),a("p",[t._v("（4）在 "),a("strong",[t._v(".travis")]),t._v(" 目录下创建 "),a("strong",[t._v("ssh_config")]),t._v(" 文件")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("cp")]),t._v(" ~/.ssh/id_rsa_blog .travis/\n")])]),a("p",[t._v("编辑 ssh_config，输入以下信息")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Host github.com\nUser git\nStrictHostKeyChecking no\nIdentityFile ~/.ssh/id_rsa\nIdentitiesOnly yes\n")])]),a("p",[t._v("（5）travis 登录\n根据提示输入github的用户名和密码")]),a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" 博客项目文件夹根目录/.travis\n$ travis login --auto\n"),a("span",{attrs:{class:"token string"}},[t._v('"We need your GitHub login to identify you.\nThis information will not be sent to Travis CI, only to api.github.com.\nThe password will not be displayed."')]),t._v("\n\n"),a("span",{attrs:{class:"token string"}},[t._v('"Try running with --github-token or --auto if you don\'t want to enter your password anyway.\n\nUsername: a298003154\nPassword for a298003154: ************\nSuccessfully logged in as a298003154!"')]),t._v("\n")])]),a("p",[t._v("（6）对ssh的私钥进行加密")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("travis encrypt-file .travis/id_rsa_blog .travis/ --add\n")])]),a("p",[t._v("此操作会生成加密之后的秘钥文件 "),a("strong",[t._v("id_rsa.enc")]),t._v(" ，删除 "),a("strong",[t._v("id_rsa")]),t._v(" 密钥文件(私钥不能随便泄露)。\n同时在终端上会输出类似如下信息：")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("openssl aes-256-cbc -K $encrypted_xxxxxxxxxxx_key -iv $encrypted_xxxxxxxxxxx_iv\n")])]),a("p",[t._v("这是用于 "),a("strong",[t._v("id_rsa.enc")]),t._v(" 解密的信息，保存上面 xxxxxxxxxxx 的信息，后面会在 "),a("strong",[t._v(".travis.yml")]),t._v(" 配置文件会用到。")]),a("h2",{attrs:{id:"编辑配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编辑配置文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 编辑配置文件")]),a("p",[t._v("（1）Travis配置文件\n打开Travis配置文件 "),a("strong",[t._v(".travis.yml")]),t._v("，添加如下信息：")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("\tlanguage: node_js\n\tnode_js:\n\t- "),a("span",{attrs:{class:"token string"}},[t._v('"4"')]),t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("# nodejs的版本")]),t._v("\n\tbranches:\n\tonly:\n\t- dev  "),a("span",{attrs:{class:"token comment"}},[t._v("# 设置自动化部署的分支")]),t._v("\n\tbefore_install:\n\t- "),a("span",{attrs:{class:"token function"}},[t._v("export")]),t._v(" TZ"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v("'Asia/Shanghai'")]),t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("# 设置时区")]),t._v("\n\t- "),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v(" -g hexo\n\t- "),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v(" -g hexo-cli\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("# 将xxxxxxxxxxx替换上面生成的内容")]),t._v("\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("# 这里面的文件路径可根据自己的情况进行修改")]),t._v("\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("# 解密id_rsa_blog.enc 输出到.ssh/文件夹下，命名为id_rsa")]),t._v("\n\t- openssl aes-256-cbc -K "),a("span",{attrs:{class:"token variable"}},[t._v("$encrypted_xxxxxxxxxxx_key")]),t._v(" -iv "),a("span",{attrs:{class:"token variable"}},[t._v("$encrypted_xxxxxxxxxxx_iv")]),t._v(" -in .travis/id_rsa.enc -out ~/.ssh/id_rsa -d\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("# 设置id_rsa文件权限")]),t._v("\n\t- "),a("span",{attrs:{class:"token function"}},[t._v("chmod")]),t._v(" 600 ~/.ssh/id_rsa\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("# 添加ssh密钥")]),t._v("\n\t- "),a("span",{attrs:{class:"token function"}},[t._v("eval")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[a("span",{attrs:{class:"token variable"}},[t._v("$(")]),t._v("ssh-agent"),a("span",{attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n\t- ssh-add ~/.ssh/id_rsa\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("# 添加ssh配置文件")]),t._v("\n\t- "),a("span",{attrs:{class:"token function"}},[t._v("cp")]),t._v(" .travis/ssh_config ~/.ssh/config\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("# 设置github账户信息")]),t._v("\n\t- "),a("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" config --global user.name "),a("span",{attrs:{class:"token string"}},[t._v('"github"')]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("#设置github用户名")]),t._v("\n\t- "),a("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" config --global user.email "),a("span",{attrs:{class:"token string"}},[t._v('"github@qq.com"')]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("#设置github用户邮箱")]),t._v("\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("# 安装依赖组件")]),t._v("\n\tinstall:\n\t- "),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v("\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("# 执行的命令")]),t._v("\n\tscript:\n\t- hexo clean "),a("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" hexo g -d\n")])]),a("p",[t._v("（2）Hexo配置文件\n打开Hexo配置文件 "),a("strong",[t._v("_config.yml")]),t._v("，编辑如下信息：")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("deploy:\n  type: git\n  repo: git@github.com:a298003154/a298003154.github.io.git\n  branch: master\n")])]),a("h2",{attrs:{id:"更新-发布博客项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新-发布博客项目","aria-hidden":"true"}},[t._v("#")]),t._v(" 更新/发布博客项目")]),a("p",[t._v("（1）初始化本地仓库\n切换到项目根目录下，删除原来部署时产生的.git文件夹。")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" init\n")])]),a("p",[t._v("（2）提交推送4步走\n提交本地修改，关联远程仓库，推送至github仓库。")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token comment"}},[t._v("# 添加文件")]),t._v("\n$ "),a("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" add "),a("span",{attrs:{class:"token keyword"}},[t._v(".")]),t._v("\n$ "),a("span",{attrs:{class:"token comment"}},[t._v("# 提交修改")]),t._v("\n$ "),a("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),a("span",{attrs:{class:"token string"}},[t._v('"test travis"')]),t._v("\n$ "),a("span",{attrs:{class:"token comment"}},[t._v("# 将github仓库改为自己的")]),t._v("\n$ "),a("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" remote add origin git@github.com:a298003154/a298003154.github.io.git\n$ "),a("span",{attrs:{class:"token comment"}},[t._v("# 推送至远程仓库")]),t._v("\n$ "),a("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" push -u origin dev\n")])]),a("p",[t._v("push本地的代码至远程仓库之后，在 "),a("a",{attrs:{href:"https://travis-ci.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("travis-ci.org")]),t._v(" 后台查看相关情况。\n下面是成功的结果：\n"),a("img",{attrs:{src:"/assets/img/travisCI/03.png",alt:"",title:"发布成功"}})]),a("h2",{attrs:{id:"报错问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#报错问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 报错问题")]),a("p",[t._v("1.Windows用户可能会出现如下错误:")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('The command "openssl aes-256-cbc -K $encrypted_xxxxxxxxxxx_key -iv $encrypted_xxxxxxxxxxx_iv -in .travis/id_rsa.enc -out ~/.ssh/id_rsa -d" failed and exited with 1 during.\n')])]),a("p",[t._v("原因是travis在执行加密操作生成的加密信息位数不对。之后在ubuntu/linux系统中操作就一切正常。")]),a("p",[t._v("如果不想安装虚拟机，还有另外一种方式实现。")]),a("p",[t._v("2.所有的配置文件是yaml格式，空格一定要注意。")])])}],!1,null,null,null);s.default=e.exports}}]);